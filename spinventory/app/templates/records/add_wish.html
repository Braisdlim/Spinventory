{% extends "base.html" %}

{% block title %}Añadir a WishList{% endblock %}

{% block content %}
<div class="add-record-container">
    <div class="add-record-card">
        <h2 class="add-record-title"><i class="fas fa-star"></i> Añadir Disco a la WishList</h2>
        <form method="POST" action="{{ url_for('records.add_wish') }}" enctype="multipart/form-data" class="add-record-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="title">Título del disco:</label>
                    <input type="text" id="title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="artist">Artista/Banda:</label>
                    <input type="text" id="artist" name="artist" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="year">Año de lanzamiento:</label>
                    <input type="number" id="year" name="year" min="1900" max="{{ current_year }}" required>
                </div>
                <div class="form-group">
                    <label for="genre">Género musical:</label>
                    <select id="genre" name="genre" required>
                        <option value="" selected disabled>Selecciona un género...</option>
                        <option value="rock">Rock</option>
                        <option value="pop">Pop</option>
                        <option value="jazz">Jazz</option>
                        <option value="electronic">Electrónica</option>
                        <option value="classical">Clásica</option>
                        <option value="hiphop">Hip Hop</option>
                        <option value="metal">Metal</option>
                        <option value="reggae">Reggae</option>
                        <option value="folk">Folk</option>
                        <option value="blues">Blues</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="cover">Portada del disco (opcional):</label>
                <input type="file" id="cover" name="cover" accept="image/jpeg, image/png, image/gif">
                <div class="form-text">
                    Formatos aceptados: JPG, PNG, GIF. Tamaño máximo: 2MB.
                </div>
            </div>
            <div class="form-group">
                <button type="button" id="auto-cover-btn" class="btn btn-secondary">Buscar portada automáticamente</button>
                <div id="auto-cover-preview" style="margin-top:1em;"></div>
                <input type="hidden" id="auto_cover_url" name="auto_cover_url">
            </div>
            <div class="form-actions">
                <a href="{{ url_for('records.wishlist') }}" class="btn btn-cancel">Cancelar</a>
                <button type="submit" class="btn btn-primary">Guardar en WishList</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Establecer año actual como máximo
document.getElementById('year').max = new Date().getFullYear();

document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('auto-cover-btn');
    if (btn) {
        btn.onclick = function() {
            const artist = document.getElementById('artist').value;
            const title = document.getElementById('title').value;
            if (!artist || !title) {
                alert("Introduce título y artista para buscar la portada.");
                return;
            }
            fetch('/records/api/cover?artist=' + encodeURIComponent(artist) + '&title=' + encodeURIComponent(title))
                .then(resp => resp.json())
                .then(data => {
                    const preview = document.getElementById('auto-cover-preview');
                    if (data.cover_url) {
                        preview.innerHTML = `<img src="${data.cover_url}" alt="Portada encontrada" style="max-width:180px; border-radius:8px; margin-bottom:0.5em;">`;
                        document.getElementById('auto_cover_url').value = data.cover_url;
                    } else {
                        preview.innerHTML = "<span style='color:#e74c3c;'>No se encontró portada.</span>";
                        document.getElementById('auto_cover_url').value = "";
                    }
                });
        };
    }
});
</script>
{% endblock %}