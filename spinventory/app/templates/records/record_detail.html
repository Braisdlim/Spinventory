{% extends "base.html" %}
{% block title %}Detalle Disco{% endblock %}
{% block content %}
<h2>{{ record.title }} - {{ record.artist }}</h2>
<p><strong>Año:</strong> {{ record.year }} | <strong>Género:</strong> {{ record.genre }}</p>
{% if record.portada_filename %}
    <img src="{{ url_for('static', filename='uploads/' ~ record.portada_filename) }}" style="max-width:180px;">
{% endif %}
<p><strong>Estado:</strong> {{ record.condition }}</p>

{% if avg_stars %}
    <p><strong>Valoración media:</strong> 
        <span style="color:#FFD700;">
          {% for i in range(avg_stars|round|int) %}★{% endfor %}
          {% for i in range(5 - (avg_stars|round|int)) %}<span style="color:#ccc;">★</span>{% endfor %}
        </span>
        ({{ avg_stars }}/5)
    </p>
{% else %}
    <p><em>Sin valoraciones aún.</em></p>
{% endif %}


    <h3>Deja tu review</h3>
    <!-- Formulario de reseña -->
    <form method="post" id="review-form">
        <label for="comment">Comentario:</label>
        <textarea name="comment" id="comment" required></textarea>
        <label>Puntuación:</label>
        <div class="star-rating">
            {% for i in range(5, 0, -1) %}
            <input type="radio" id="star{{ i }}" name="stars" value="{{ i }}" required>
            <label for="star{{ i }}" title="{{ i }} estrellas">&#9733;</label>
            {% endfor %}
        </div>
        <button type="submit">Enviar reseña</button>
    </form>


<h3>Reviews</h3>
{% for rv in reviews %}
    <div>
        <strong>
          {{ users_by_email[rv.user_email].username if rv.user_email in users_by_email else rv.user_email }}
        </strong>
        <span style="color:#FFD700;">
            {% for i in range(rv.stars) %}★{% endfor %}
            {% for i in range(5 - rv.stars) %}<span style="color:#ccc;">★</span>{% endfor %}
        </span>
        <br>
        <em>{{ rv.comment }}</em>
        {% if rv.user_email == current_user.email %}
            <form method="post" action="{{ url_for('records.delete_review', review_id=rv._id) }}" style="display:inline;">
                <button type="submit" onclick="return confirm('¿Seguro que quieres borrar esta reseña?');" class="btn btn-danger btn-xs">Eliminar</button>
            </form>
        {% endif %}
    </div>
{% else %}
    <p>No hay reviews aún.</p>
{% endfor %}
{% endblock %}